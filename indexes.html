<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The Love Bible</title>
    <!-- Bootstrap Modal CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/topcoat-mobile-light.min.css">
    <link rel="stylesheet" type="text/css" href="css/styles.css">

    <style>
        #novel-content {
            word-wrap: break-word;
            overflow-wrap: break-word;
            font-size: 12px; /* Adjust the font size as needed */
            line-height: 1.0; /* Adjust the line height as needed */
        }
    </style>
</head>
<body>
    <header style="position: fixed; width: 100%; top: 0; z-index: 100;">
        <div class="topcoat-navigation-bar">
            <div class="topcoat-navigation-bar__item center full">
                <h2 class="topcoat-navigation-bar__title">THE <span style="color: rgb(255, 0, 0);">L‚ù¶VE</span> BIBLE</h2>
            </div>         
        </div>    
    </header>
        
    
    <h3 class="checker" onclick="checkSupport()">üîä</h3>
    <section>
        <div id="customise-options">
            <br><label id="voice-label">
               
                <div id="voice-container"> Select Voice :<br>
                    <select id="select-voice">
                        <option value="Daniel">Default Voice</option>
                        <option value="UK English Female">USA Female Voice</option>
                        <option value="UK English Male">USA Male Voice</option>
                        <option value="US English Female">UK Female Voice</option>
                        <option value="Dutch Female">UK Male Voice</option>
                        <option value="US English Male">African Male Voice</option>
                        <option value="Australian Female">African Female Voice</option>
                        <option value="Japanese Female">Japanese Female Voice</option>
                        <option value="Korean Female">Korean Female Voice</option>
                    </select>                      
                </div><br>
                <label id="repeat-label">
                    <b>Playback Mode:</b>
                    <div id="repeat-container">
                        <select id="select-repeat">
                            <option value="repeat">Repeat One</option>
                            <option value="next">Loop All</option>
                        </select>                      
                    </div>
                </label>
                
            </label>   
            <!-- <label id="speed-label">
                Select Speech Speed :
                <div id="speed-container">
                    <input id="select-speed" type="range" class="topcoat-range" min="0" max="1.5" value="1" step="0.1" onchange="setSpeed(this.value)">
                </div>
            </label>    -->
     <!-- Add select element for choosing text files -->
<label id="text-label">
    <br><b>Select Chapter :</b>
    <div id="text-container">
        <select id="select-text">
            <option value="table of contents.txt">Table of Contents</option>
            <option value="prologue.txt">Prologue</option>
            <option value="acknowledgement.txt">Acknowledgement</option>
            <option value="preface.txt">Preface</option>
            <option value="aurthors note.txt">Author's Note</option>   
            <option value="Genesis.txt">Genesis</option>
            <option value="the first valentine gift.txt">The First Valentine Gift</option>
            <option value="exodus.txt">Exodus</option>
            <option value="the surprise invitation.txt">The Surprise Invitation</option>
            <option value="lillies siblings.txt">Lillie's Siblings</option>
            <option value="a friend in need is a friend indeed.txt">A Friend in Need is a Friend Indeed</option>
            <option value="bestie wa me.txt">Bestie Wa Me</option>
            <option value="the forbidden fruit tastes sweeter.txt">The Forbidden Fruit Tastes Sweeter</option>
            <option value="honey is sweet but bees bite.txt">Honey is Sweet But Bees Bite</option>
            <option value="valentines day.txt">Valentine's Day</option>
            <option value="party after party.txt">Party After Party</option>
            <option value="chronicles.txt">Chronicles</option>
            <option value="for god and my love.txt">For God and my Love</option>
            <option value="it is what it is.txt">It Is What It Is</option>
            <option value="1000 names of lillian.txt">1000 Names of Lillian</option>
            <option value="my birthday party.txt">My Birthday Party</option>
            <option value="let sleeping dogs lie.txt">Let Sleeping Dogs Lie</option>
            <option value="love at first sight.txt">Love at First Sight</option>
            <option value="lamentations.txt">Lamentations</option>
            <option value="love at last.txt">Love at Last</option>
            <option value="MYOB.txt">MYOB</option>
            <option value="Revelation.txt">Revelation</option>
        </select>
    </div>
</label>                                  

        </div>
        <div class="button-row">
            <button id="stop-button" class="topcoat-button" onclick="stopSpeech()">STOP</button>
            <button id="speak-button" class="topcoat-button--cta" onclick="loadText()">READ</button>            
        </div><br>
        <!-- Add a download button for audio files -->
        <center><button id="download-audio" class="topcoat-button" style="display: none; background-color: green; width: 180px;" onclick="downloadAudio()">Download üîä</button>
        </center><p></p>
        <div id="novel-content" class="topcoat-textarea mousetrap">Select a chapter from the dropdown menu and click on the "READ" button to load its contents here...</div>             

        <div id="links">
            <ul>
                <li>
                    <a href="https://akamuli-ka-lillie.vercel.app" target="_blank">
                            <img src="images/github.png" alt="Logo of github Octocat anchoring to the GitHub page of Online TTS">
                    </a>
                </li>
                <li>
                    <img src="images/help.png" alt="Image of a question mark which on click provides info about how to use Online TTS" onclick="info()">
                </li>
            </ul>
        </div>
    </section>
    <br>
   <!-- Footer -->
    
   <footer class="footer" id="contact">
    
    <div class="container">

        <p>&copy; Jesse and Family <br>All feelings reserved <span id="currentYear"></span></p>


    </div>

</footer>

<!-- Bootstrap Modal -->
<div class="modal fade" id="voiceModal" tabindex="-1" aria-labelledby="voiceModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="voiceModalLabel">Voice Not Supported</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Unfortunately, the <b>Default Voice</b> is not supported in this chapter. Please select an alternative voice from the list below and try again...</p>
                <label for="select-voice-modal">Select Alternative Voice:</label>
                <select id="select-voice-modal" class="form-control">
                    <option value="UK English Female">USA Female Voice</option>
                    <option value="UK English Male">USA Male Voice</option>
                    <option value="US English Female">UK Female Voice</option>
                    <option value="Dutch Female">UK Male Voice</option>
                    <option value="US English Male">African Male Voice</option>
                    <option value="Australian Female">African Female Voice</option>
                    <option value="Japanese Female">Japanese Female Voice</option>
                    <option value="Korean Female">Korean Female Voice</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="selectAlternativeVoice()">Select Voice</button>
            </div>
        </div>
    </div>
</div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=R06QTECg"></script>
    <script type="text/javascript" src="js/mousetrap.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script>
        
function selectAlternativeVoice() {
    // Get the selected voice from the modal dropdown menu
    let selectedVoice = document.getElementById('select-voice-modal').value;
    // Set the selected voice in the main select voice dropdown menu
    document.getElementById('select-voice').value = selectedVoice;
    // Hide the modal
    $('#voiceModal').modal('hide');
    // Load text with the selected alternative voice
    loadText();
}


        // List of text files in chronological order
        const textFiles = [
            "table of contents.txt",
            "prologue.txt",
            "acknowledgement.txt",
            "preface.txt",
            "aurthors note.txt",
            "Genesis.txt",
            "the first valentine gift.txt",
            "exodus.txt",
            "the surprise invitation.txt",
            "lillies siblings.txt",
            "a friend in need is a friend indeed.txt",
            "bestie wa me.txt",
            "the forbidden fruit tastes sweeter.txt",
            "honey is sweet but bees bite.txt",
            "valentines day.txt",
            "party after party.txt",
            "chronicles.txt",
            "for god and my love.txt",
            "it is what it is.txt",
            "1000 names of lillian.txt",
            "my birthday party.txt",
            "let sleeping dogs lie.txt",
            "love at first sight.txt",
            "lamentations.txt",
            "love at last.txt",
            "MYOB.txt",
            "Revelation.txt"
        ];

        // List of audio files corresponding to the text files
        const audioFiles = [
            "https://fresh-teacher.github.io/Audio-Books/Table of Contents.mp3",
            "https://fresh-teacher.github.io/Audio-Books/Prologue.mp3",
            "https://fresh-teacher.github.io/Audio-Books/Acknowledgement.mp3",
            "https://fresh-teacher.github.io/Audio-Books/Preface.mp3",
            "https://fresh-teacher.github.io/Audio-Books/Author's Note.mp3",
            "https://fresh-teacher.github.io/video-maker/Genesis.mp3",
            "https://fresh-teacher.github.io/video-maker/The First Valentine Gift.mp3",
            "https://fresh-teacher.github.io/video-maker/Exodus.mp3",
            "https://fresh-teacher.github.io/video-maker/The Surprise Invitation.mp3",
            "https://fresh-teacher.github.io/video-maker/Lillian's Siblings.mp3",
            "https://fresh-teacher.github.io/video-maker/A Friend in Need is a Friend Indeed.mp3",
            "https://fresh-teacher.github.io/video-maker/Bestie wa Me.mp3",
            "https://fresh-teacher.github.io/video-maker/The Forbidden Fruit Tastes Sweeter.mp3",
            "https://fresh-teacher.github.io/video-maker/Honey is Sweet But Bees Bite.mp3",
            "https://fresh-teacher.github.io/video-maker/Valentines Day.mp3",
            "https://fresh-teacher.github.io/video-maker/Party After Party.mp3",
            "https://fresh-teacher.github.io/video-maker/Chronicles.mp3",
            "https://fresh-teacher.github.io/video-maker/For God and My Love.mp3",
            "https://fresh-teacher.github.io/video-maker/It is what it is.mp3",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
            "https://drive.google.com/uc?export=download&id=1NtlqDx6kpeS6s0Xv6LFdOR7ZajEK4j_4",
        ];

        // Function to check if audio is available for the selected chapter
    function checkAudioAvailability() {
        let selectElement = document.getElementById('select-text');
        let selectedText = selectElement.options[selectElement.selectedIndex].value;
        let selectedAudioIndex = textFiles.indexOf(selectedText);
        if (selectedAudioIndex !== -1 && audioFiles[selectedAudioIndex] !== "") {
            document.getElementById('download-audio').style.display = "block";
        } else {
            document.getElementById('download-audio').style.display = "none";
        }
    }

// Function to load and play the next chapter
function loadAndPlayNextChapter(currentIndex) {
    currentIndex++;
    // If all text files have been read, reset to the beginning
    if (currentIndex >= textFiles.length) {
        currentIndex = 0;
    }
    // Load the next text file
    let nextText = textFiles[currentIndex];
    fetch(nextText)
        .then(response => response.text())
        .then(nextTextContent => {
            document.getElementById('novel-content').innerText = nextTextContent;
            // Update the selected option in the dropdown menu
            let selectElement = document.getElementById('select-text');
            for (let i = 0; i < selectElement.options.length; i++) {
                if (selectElement.options[i].value === nextText) {
                    selectElement.selectedIndex = i;
                    break;
                }
            }
            // Play the audio associated with the selected text file
            let audio = new Audio(audioFiles[currentIndex]);
            audio.play();
            // When the audio ends, load and play the next chapter
            audio.addEventListener('ended', () => loadAndPlayNextChapter(currentIndex));
        })
        .catch(error => console.error('Error reading next text:', error));
}


// Function to load and play the selected chapter
function loadText() {
    // Get the selected text file from the dropdown menu
    let selectElement = document.getElementById('select-text');
    let selectedText = selectElement.options[selectElement.selectedIndex].value;
    let selectedVoice = document.getElementById('select-voice').value;
    let repeatOption = document.getElementById('select-repeat').value;

    // Load the text content from the selected text file
    fetch(selectedText)
        .then(response => response.text())
        .then(text => {
            // Display the text content on the page
            document.getElementById('novel-content').innerText = text;

            // Get the index of the selected text file
            let index = textFiles.indexOf(selectedText);

            // If the selected voice is "Daniel"
            if (selectedVoice === 'Daniel') {
                if (index !== -1) {
                    // Check if the selected chapter has a Google Drive link
                    let isGoogleDriveLink = audioFiles[index].includes("drive.google.com");
                    if (isGoogleDriveLink) {
                        // Display modal warning about Google Drive link with Daniel voice
                        $('#voiceModal').modal('show');
                        return; // Stop execution
                    } else {
                        // Play the audio associated with the selected text file
                        let audio = new Audio(audioFiles[index]);
                        audio.play();
                        // When the audio ends, load and play the next chapter or repeat the current chapter
                        audio.addEventListener('ended', () => {
                            if (repeatOption === 'next') {
                                loadAndPlayNextChapter(index);
                            } else {
                                loadText(); // Repeat the current chapter
                            }
                        });
                    }
                }
            } else {
                // Speak the text content using responsive voice
                responsiveVoice.speak(text, selectedVoice, {
                    onend: function () {
                        // Load and play the next chapter or repeat the current chapter
                        if (repeatOption === 'next') {
                            loadAndPlayNextChapter(index);
                        } else {
                            responsiveVoice.speak(text, selectedVoice);
                        }
                    }
                });
            }
        })
        .catch(error => console.error('Error reading selected text:', error));
}



// Function to load and play the next chapter
function loadAndPlayNextChapter(currentIndex) {
    currentIndex++;
    // If all text files have been read, reset to the beginning
    if (currentIndex >= textFiles.length) {
        currentIndex = 0;
    }
    // Load the next text file
    let nextText = textFiles[currentIndex];
    fetch(nextText)
        .then(response => response.text())
        .then(nextTextContent => {
            document.getElementById('novel-content').innerText = nextTextContent;
            // Update the selected option in the dropdown menu
            let selectElement = document.getElementById('select-text');
            for (let i = 0; i < selectElement.options.length; i++) {
                if (selectElement.options[i].value === nextText) {
                    selectElement.selectedIndex = i;
                    break;
                }
            }
            // Play the audio associated with the selected text file
            let audio = new Audio(audioFiles[currentIndex]);
            audio.play();
            // When the audio ends, load and play the next chapter
            audio.addEventListener('ended', () => loadAndPlayNextChapter(currentIndex));
        })
        .catch(error => console.error('Error reading next text:', error));
}


function stopSpeech() {
    // Stop the ResponsiveVoice speech
    responsiveVoice.cancel();

    // Reload the page to stop any audio playback from links
    location.reload();
}


        function checkSupport() {
            // Check if the default voice (Daniel) is selected
            if (document.getElementById('select-voice').value === 'Daniel') {
                // Display modal for voice selection
                $('#voiceModal').modal('show');
            } else {
                // Hide the modal
                $('#voiceModal').modal('hide');
            }
        }

        function setSpeed(speed) {
            // Set the speech speed
            responsiveVoice.cancel(); // Stop current speech
            let voice = document.getElementById('select-voice').value;
            responsiveVoice.setDefaultRate(speed);
            if (voice !== 'Daniel') {
                let text = document.getElementById('novel-content').innerText;
                responsiveVoice.speak(text, voice, { rate: speed });
            }
        }

        function info() {
            // Show info about using the TTS
    alert("GUIDELINES: \n1. Voice Selection: You can choose your preferred voice for text-to-speech conversion by selecting from the dropdown menu labelled 'Select Voice.' The available voices include options such as USA Female Voice, USA Male Voice, UK Female Voice, etc.\n\n3. Playback Mode: You may choose between two playback modes: 'Repeat One' and 'Loop All' from the dropdown menu labelled 'Playback Mode.' 'Repeat One' repeats the current chapter continuously, while 'Loop All' automatically moves to the next chapter after the current one finishes.\n\n4. Chapter Selection: You can select the desired chapter from the dropdown menu labelled 'Select Chapter.' The available chapters are listed in chronological order, making it easy for you to find and select the chapter you wanna to listen to.\n\n5. Playback Controls: The 'READ' button initiates the text-to-speech conversion for the selected chapter. The 'STOP' button allows you to stop the speech playback at any time.\n\n6. Additional Features: You may access additional information by clicking on the icon of Jesse and Lillian. \n\nEnjoy the experience! üòä");
        }

        function downloadAudio() {
            // Get the selected text file
            let selectedText = document.getElementById('select-text').value;
            // Get the index of the selected text file in the textFiles array
            let index = textFiles.indexOf(selectedText);
            // Create a temporary anchor element to trigger download
            let link = document.createElement('a');
            link.href = audioFiles[index];
            link.download = selectedText.split('.')[0] + '.mp3';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        document.getElementById("currentYear").innerHTML = new Date().getFullYear();

            // Function to download the audio file for the selected chapter
    function downloadAudio() {
        let selectElement = document.getElementById('select-text');
        let selectedText = selectElement.options[selectElement.selectedIndex].value;
        let selectedAudioIndex = textFiles.indexOf(selectedText);
        if (selectedAudioIndex !== -1) {
            let audioFile = audioFiles[selectedAudioIndex];
            let link = document.createElement('a');
            link.href = audioFile;
            link.download = audioFile.split('/').pop();
            link.click();
        } else {
            console.error('Audio file not found for the selected chapter');
        }
    }

    // Initial check if the default chapter is the table of contents
    document.addEventListener("DOMContentLoaded", function () {
        checkAudioAvailability();
    });
    </script>
</body>
</html>
